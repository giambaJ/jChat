<!DOCTYPE html>
<html>
  <head>
    <title>jChat &bull; Setup | giambaJ</title>
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Baloo+Tammudu+2:wght@400;500;600;700;800&family=Comfortaa:wght@300;400;500;600;700&family=Dancing+Script:wght@400;500;600;700&family=Indie+Flower&family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Noto+Sans+JP:wght@100;300;400;500;700;900&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Source+Code+Pro:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,900;1,200;1,300;1,400;1,500;1,600;1,700;1,900&family=Press+Start+2P&family=Wallpoet&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles/style.css" />
    <link rel="stylesheet" class="preview_size" href="styles/size_large.css" />
    <link
      rel="stylesheet"
      class="preview_font"
      href="styles/font_BalooTammudu.css"
    />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.8.3/jquery.min.js"
      integrity="sha512-J9QfbPuFlqGD2CYVCa6zn8/7PEgZnGpM5qtFOBZgwujjDnG5w5Fjx46YzqvIh/ORstcj7luStvvIHkisQi5SKw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script defer>
      const fonts = [
        'BalooTammudu',
        'SegoeUI',
        'Roboto',
        'Lato',
        'NotoSans',
        'SourceCodePro',
        'Impact',
        'Comfortaa',
        'DancingScript',
        'IndieFlower',
        'PressStart2P',
        'Wallpoet',
      ];

      const sizes = ['small', 'medium', 'large'];

      const strokes = ['thin', 'medium', 'thick', 'thicker'];

      const shadows = ['small', 'medium', 'large'];
    </script>
    <script defer>
      function encodeQueryData(data) {
        // https://stackoverflow.com/questions/111529/how-to-create-query-parameters-in-javascript
        const ret = [];
        for (let d in data) {
          if (data[d])
            ret.push(encodeURIComponent(d) + '=' + encodeURIComponent(data[d]));
        }
        return ret.join('&');
      }

      function appendCSS(type, name) {
        $('<link/>', {
          rel: 'stylesheet',
          type: 'text/css',
          class: `preview_${type}`,
          href: `styles/${type}_${name}.css`,
        }).appendTo('head');
      }

      function removeCSS(type) {
        $(`link[class="preview_${type}"]`).remove();
      }
    </script>
    <script defer>
      function fadeOption(event) {
        if ($fade_bool.is(':checked')) {
          $fade.removeClass('hidden');
          $fade_seconds.removeClass('hidden');
        } else {
          $fade.addClass('hidden');
          $fade_seconds.addClass('hidden');
        }
      }

      function sizeUpdate(event) {
        let size = sizes[Number($size.val()) - 1];
        removeCSS('size');
        appendCSS('size', size);
      }

      function fontUpdate(event) {
        let font = fonts[Number($font.val())];
        removeCSS('font');
        appendCSS('font', font);
      }

      function strokeUpdate(event) {
        removeCSS('stroke');
        if ($stroke.val() == '0') return;
        else {
          let stroke = strokes[Number($stroke.val()) - 1];
          appendCSS('stroke', stroke);
        }
      }

      function shadowUpdate(event) {
        removeCSS('shadow');
        if ($shadow.val() == '0') return;
        else {
          let shadow = shadows[Number($shadow.val()) - 1];
          appendCSS('shadow', shadow);
        }
      }

      function badgesUpdate(event) {
        if ($badges.is(':checked')) {
          $('img[class="badge special"]').addClass('hidden');
        } else {
          $('img[class="badge special hidden"]').removeClass('hidden');
        }
      }

      function capsUpdate(event) {
        if ($small_caps.is(':checked')) {
          appendCSS('variant', 'SmallCaps');
        } else {
          removeCSS('variant');
        }
      }

      function generateURL(event) {
        event.preventDefault();

        const generatedUrl =
          'http://localhost:8080/twitch/v2/index.html?channel=' +
          $channel.val();

        let data = {
          size: $size.val(),
          font: $font.val(),
          stroke: $stroke.val() != '0' ? $stroke.val() : false,
          shadow: $shadow.val() != '0' ? $shadow.val() : false,
          bots: $bots.is(':checked'),
          hide_commands: $commands.is(':checked'),
          hide_badges: $badges.is(':checked'),
          animate: $animate.is(':checked'),
          fade: $fade_bool.is(':checked') ? $fade.val() : false,
          small_caps: $small_caps.is(':checked'),
        };

        const params = encodeQueryData(data);

        $url.val(generatedUrl + '&' + params);

        $generator.addClass('hidden');
        $result.removeClass('hidden');
      }

      function changePreview(event) {
        if ($example.hasClass('white')) {
          $example.removeClass('white');
          $brightness.attr('src', 'img/light.png');
        } else {
          $example.addClass('white');
          $brightness.attr('src', 'img/dark.png');
        }
      }

      function copyUrl(event) {
        navigator.clipboard.writeText($url.val());

        $alert.css('visibility', 'visible');
        $alert.css('opacity', '1');
      }

      function showUrl(event) {
        $alert.css('opacity', '0');
        setTimeout(function () {
          $alert.css('visibility', 'hidden');
        }, 200);
      }

      function resetForm(event) {
        $channel.val('');
        $size.val('3');
        $font.val('0');
        $stroke.val('0');
        $shadow.val('0');
        $bots.prop('checked', false);
        $commands.prop('checked', false);
        $badges.prop('checked', false);
        $animate.prop('checked', false);
        $fade_bool.prop('checked', false);
        $fade.addClass('hidden');
        $fade_seconds.addClass('hidden');
        $fade.val('30');
        $small_caps.prop('checked', false);

        sizeUpdate();
        fontUpdate();
        strokeUpdate();
        shadowUpdate();
        badgesUpdate();
        capsUpdate();
        if ($example.hasClass('white')) changePreview();

        $result.addClass('hidden');
        $generator.removeClass('hidden');
        showUrl();
      }

      const $generator = $("form[name='generator']");
      const $channel = $('input[name="channel"]');
      const $animate = $('input[name="animate"]');
      const $bots = $('input[name="bots"]');
      const $fade_bool = $("input[name='fade_bool']");
      const $fade = $("input[name='fade']");
      const $fade_seconds = $('#fade_seconds');
      const $commands = $("input[name='commands']");
      const $small_caps = $("input[name='small_caps']");
      const $badges = $("input[name='badges']");
      const $size = $("select[name='size']");
      const $font = $("select[name='font']");
      const $stroke = $("select[name='stroke']");
      const $shadow = $("select[name='shadow']");
      const $brightness = $('#brightness');
      const $example = $('#example');
      const $result = $('#result');
      const $url = $('#url');
      const $alert = $('#alert');
      const $reset = $('#reset');

      $fade_bool.change(fadeOption);
      $size.change(sizeUpdate);
      $font.change(fontUpdate);
      $stroke.change(strokeUpdate);
      $shadow.change(shadowUpdate);
      $small_caps.change(capsUpdate);
      $badges.change(badgesUpdate);
      $generator.submit(generateURL);
      $brightness.click(changePreview);
      $url.click(copyUrl);
      $alert.click(showUrl);
      $reset.click(resetForm);
    </script>
  </head>

  <body>
    <header>
      <img src="img/peepoHappy.png" />
      <div>
        <h1>jChat</h1>
        <h2>Setup</h2>
      </div>
    </header>

    <section>
      <p>
        <em>jChat</em> is an overlay that allows you to show your Twitch chat on
        screen with OBS, XSplit, and any other streaming software that supports
        browser sources. It supports your
        <a href="https://betterttv.com/" target="_blank">BetterTTV</a>,
        <a href="https://www.frankerfacez.com/" target="_blank">FrankerFaceZ</a>
        and <a href="https://7tv.app/" target="_blank">7TV</a> emotes, always at
        the best available quality. You have many options to customize your
        chat, like enabling a smooth animation for new messages, or fading old
        ones after some time. If you have a chat full of !gamble addicts, you
        can choose to hide bots and commands messages. It also comes with many
        fonts and styling options that can be combined as desired.
      </p>

      <form name="generator">
        <div class="form_row center">
          <input type="text" name="channel" required placeholder="Channel" />
        </div>
        <div class="form_table">
          <div class="form_col">
            <div class="form_row left">
              <select name="size">
                <option value="1">Small</option>
                <option value="2">Medium</option>
                <option value="3" selected>Large</option>
              </select>
              <label for="size">Size</label>
            </div>
            <div class="form_row left">
              <select name="font">
                <option value="0" selected>Baloo Tammudu</option>
                <option value="1">Segoe UI</option>
                <option value="2">Roboto</option>
                <option value="3">Lato</option>
                <option value="4">Noto Sans</option>
                <option value="5">Source Code Pro</option>
                <option value="6">Impact</option>
                <option value="7">Comfortaa</option>
                <option value="8">Dancing Script</option>
                <option value="9">Indie Flower</option>
                <option value="10">Press Start 2P</option>
                <option value="11">Wallpoet</option>
              </select>
              <label for="font">Font</label>
            </div>
            <br />
            <div class="form_row left">
              <input type="checkbox" name="bots" />
              <label for="bots">Show bots</label>
            </div>
            <div class="form_row left">
              <input type="checkbox" name="commands" />
              <label for="commands">Hide commands</label>
            </div>
            <div class="form_row left">
              <input type="checkbox" name="badges" />
              <label for="badges">Hide special badges</label>
            </div>
          </div>
          <div class="form_col">
            <div class="form_row right">
              <label for="stroke">Stroke</label>
              <select name="stroke">
                <option value="0" selected>Off</option>
                <option value="1">Thin</option>
                <option value="2">Medium</option>
                <option value="3">Thick</option>
                <option value="4">Thicker</option>
              </select>
            </div>
            <div class="form_row right">
              <label for="shadow">Shadow</label>
              <select name="shadow">
                <option value="0" selected>Off</option>
                <option value="1">Small</option>
                <option value="2">Medium</option>
                <option value="3">Large</option>
              </select>
            </div>
            <br />
            <div class="form_row right">
              <label for="animate">Animate</label>
              <input type="checkbox" name="animate" />
            </div>
            <div class="form_row right">
              <label for="fade">Fade</label>
              <input
                type="text"
                name="fade"
                value="30"
                class="short hidden"
              /><span id="fade_seconds" class="hidden">sec</span>
              <input type="checkbox" name="fade_bool" />
            </div>
            <div class="form_row right">
              <label for="small_caps">Caps</label>
              <input type="checkbox" name="small_caps" />
            </div>
          </div>
        </div>

        <div id="submit_container">
          <div class="preview">
            <img id="brightness" src="img/light.png" /> <label>Preview:</label>
          </div>
          <div id="example">
            <div class="chat_line">
              <span class="user_info"
                ><img
                  class="badge special"
                  src="https://cdn.frankerfacez.com/badge/3/4"
                  style="background-color: rgb(117, 80, 0)"
                /><img
                  class="badge special"
                  src="https://cdn.7tv.app/badge/60d5998fb0ac44b85331fe2b/3x"
                /><img
                  class="badge"
                  src="https://static-cdn.jtvnw.net/badges/v1/3158e758-3cb4-43c5-94b3-7639810451c5/3"
                /><span class="nick" style="color: rgb(38, 255, 0)"
                  >giambaJ</span
                >
                <span class="colon">:</span> </span
              ><span class="message"
                ><img
                  class="cheer_emote"
                  src="https://d3aqoihi2n8ty8.cloudfront.net/actions/cheer/dark/animated/100/4.gif" /><span
                  class="cheer_bits"
                  >100</span
                >
                Nice chat
                <img
                  class="emote"
                  src="https://cdn.betterttv.net/frankerfacez_emote/341767/4" />
                <img
                  class="emote"
                  src="https://cdn.7tv.app/emote/6040aacfcf6746000db1034f/4x"
              /></span>
            </div>
          </div>
          <input type="submit" value="Generate" />
        </div>
      </form>
      <div id="result" class="hidden">
        <div id="alert">Copied to clipboard</div>
        <input type="text" id="url" readonly />
        <p>
          Configure a new browser source on your streaming software with the
          given URL.
        </p>
        <input type="button" id="reset" value="Reset" />
      </div>
    </section>

    <section id="donation">
      <span
        >This app is and will always be free.<br />If you like it and want to
        support, feel free to buy me a beer
        <img class="emote" src="img/Okayge.png" /><img
          class="emote"
          src="img/BeerTime.gif"
      /></span>
      <form action="https://www.paypal.com/donate" method="post" target="_top">
        <input type="hidden" name="hosted_button_id" value="SRGWJ9QMHMHUG" />
        <input
          id="paypal"
          type="submit"
          title="PayPal - The safer, easier way to pay online!"
          alt="Donate with PayPal button"
          value="Donate"
        />
      </form>
    </section>

    <footer>
      <p>
        Made with &#10084; by <a href="mailto:me@giambaj.it">giambaJ</a>
        <a href="https://github.com/giambaJ/jChat" target="_blank"
          ><img class="github" src="img/github.png"
        /></a>
      </p>
      <p>
        This application is not affiliated with
        <a href="https://www.twitch.tv/" target="_blank">Twitch</a>
      </p>
    </footer>
  </body>
</html>
